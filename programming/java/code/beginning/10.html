<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ch10 - Writing Files</title>
<meta name="generator" content="Org mode" />
</head>
<body>
<div id="content">
<h1 class="title">ch10 - Writing Files</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6f3a6e3"><code>GatheringWrite.java</code></a></li>
<li><a href="#org491a353"><code>PrimesToFile2.java</code></a></li>
<li><a href="#org4a7e2b1"><code>PrimesToFile3.java</code></a></li>
<li><a href="#orgd5b46e0"><code>PrimesToFile.java</code></a></li>
<li><a href="#orgbe29d8f"><code>UsingAFormatter.java</code></a></li>
<li><a href="#org0f662c6"><code>WriteAStringAsBytes.java</code></a></li>
<li><a href="#orge1a9ebf"><code>WriteAString.java</code></a></li>
<li><a href="#org92e4133"><code>WriteProverbs.java</code></a></li>
</ul>
</div>
</div>

<div id="outline-container-org6f3a6e3" class="outline-2">
<h2 id="org6f3a6e3"><code>GatheringWrite.java</code></h2>
<div class="outline-text-2" id="text-org6f3a6e3">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">ceil</span>;
<span class="linenr"> 2: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">sqrt</span>;
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">File</span>;
<span class="linenr"> 5: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span>;
<span class="linenr"> 6: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>;
<span class="linenr"> 7: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">IOException</span>;
<span class="linenr"> 8: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>;
<span class="linenr"> 9: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #d55e00; font-weight: bold;">channels</span>.<span style="color: #0072b2; font-weight: bold;">FileChannel</span>;
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">class</span> <span style="color: #0072b2; font-weight: bold;">GatheringWrite</span> {
<span class="linenr">12: </span>  <span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #0072b2; font-weight: bold;">void</span> <span style="color: #d55e00;">main</span>(<span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">args</span>) {
<span class="linenr">13: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">primesRequired</span> = 100; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Default count</span>
<span class="linenr">14: </span>    <span style="color: #56b4e9; font-weight: bold;">if</span> (args.length &gt; 0) {
<span class="linenr">15: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">16: </span>        primesRequired = Integer.valueOf(args[0]).intValue();
<span class="linenr">17: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">NumberFormatException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">18: </span>        System.out.println(<span style="color: #848ea9;">"Prime count value invalid. Using default of "</span> + primesRequired);
<span class="linenr">19: </span>      }
<span class="linenr">20: </span>    }
<span class="linenr">21: </span>
<span class="linenr">22: </span>    <span style="color: #0072b2; font-weight: bold;">long</span>[] <span style="color: #e69f00; font-weight: bold;">primes</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">long</span>[primesRequired]; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Array to store primes</span>
<span class="linenr">23: </span>    primes[0] = 2; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Seed the first prime</span>
<span class="linenr">24: </span>    primes[1] = 3; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">and the second</span>
<span class="linenr">25: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Count of primes found - up to now, which is also the array index</span>
<span class="linenr">26: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">count</span> = 2;
<span class="linenr">27: </span>    <span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">number</span> = 5; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Next integer to be tested</span>
<span class="linenr">28: </span>
<span class="linenr">29: </span>    <span style="color: #d55e00; font-weight: bold;">outer</span>:
<span class="linenr">30: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (; count &lt; <span style="color: #0072b2; font-weight: bold;">primesRequired</span>; number += 2) {
<span class="linenr">31: </span>
<span class="linenr">32: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">The maximum divisor we need to try is square root of number</span>
<span class="linenr">33: </span>      <span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">limit</span> = (<span style="color: #0072b2; font-weight: bold;">long</span>) ceil(sqrt((<span style="color: #0072b2; font-weight: bold;">double</span>) number));
<span class="linenr">34: </span>
<span class="linenr">35: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Divide by all the primes we have up to limit</span>
<span class="linenr">36: </span>      <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">i</span> = 1; i &lt; <span style="color: #0072b2; font-weight: bold;">count</span> &amp;&amp; primes[i] &lt;= limit; i++) {
<span class="linenr">37: </span>        <span style="color: #56b4e9; font-weight: bold;">if</span> (number % primes[i] == 0) { <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Is it an exact divisor?</span>
<span class="linenr">38: </span>          <span style="color: #56b4e9; font-weight: bold;">continue</span> <span style="color: #d55e00; font-weight: bold;">outer</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">yes, try the next number</span>
<span class="linenr">39: </span>        }
<span class="linenr">40: </span>      }
<span class="linenr">41: </span>      primes[count++] = number; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">We got one!</span>
<span class="linenr">42: </span>    }
<span class="linenr">43: </span>
<span class="linenr">44: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">aFile</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(<span style="color: #848ea9;">"/tmp/primes2.txt"</span>); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Different file!</span>
<span class="linenr">45: </span>    <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span> <span style="color: #e69f00; font-weight: bold;">outputFile</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">46: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">47: </span>      outputFile = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>(aFile);
<span class="linenr">48: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">49: </span>      e.printStackTrace(System.err);
<span class="linenr">50: </span>      System.exit(1);
<span class="linenr">51: </span>    }
<span class="linenr">52: </span>    <span style="color: #0072b2; font-weight: bold;">FileChannel</span> <span style="color: #e69f00; font-weight: bold;">file</span> = outputFile.getChannel();
<span class="linenr">53: </span>
<span class="linenr">54: </span>    <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>[] <span style="color: #e69f00; font-weight: bold;">buffers</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>[3]; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Array of buffer references</span>
<span class="linenr">55: </span>    buffers[0] = ByteBuffer.allocate(8); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">To hold a double value</span>
<span class="linenr">56: </span>    buffers[2] = ByteBuffer.allocate(8); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">To hold a long value</span>
<span class="linenr">57: </span>
<span class="linenr">58: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">primeStr</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">59: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">prime</span> : primes) {
<span class="linenr">60: </span>      primeStr = <span style="color: #848ea9;">"prime = "</span> + prime;
<span class="linenr">61: </span>      buffers[0].putDouble((<span style="color: #0072b2; font-weight: bold;">double</span>) primeStr.length()).flip();
<span class="linenr">62: </span>      buffers[1] = ByteBuffer.allocate(primeStr.length());
<span class="linenr">63: </span>      buffers[1].put(primeStr.getBytes()).flip();
<span class="linenr">64: </span>      buffers[2].putLong(prime).flip();
<span class="linenr">65: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">66: </span>        file.write(buffers);
<span class="linenr">67: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">68: </span>        e.printStackTrace(System.err);
<span class="linenr">69: </span>        System.exit(1);
<span class="linenr">70: </span>      }
<span class="linenr">71: </span>      buffers[0].clear();
<span class="linenr">72: </span>      buffers[2].clear();
<span class="linenr">73: </span>    }
<span class="linenr">74: </span>
<span class="linenr">75: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">76: </span>      System.out.println(<span style="color: #848ea9;">"File written is "</span> + file.size() + <span style="color: #848ea9;">" bytes."</span>);
<span class="linenr">77: </span>      outputFile.close(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Close the file and its channel</span>
<span class="linenr">78: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">79: </span>      e.printStackTrace(System.err);
<span class="linenr">80: </span>      System.exit(1);
<span class="linenr">81: </span>    }
<span class="linenr">82: </span>
<span class="linenr">83: </span>    System.out.println(<span style="color: #848ea9;">"File closed"</span>);
<span class="linenr">84: </span>    System.exit(0);
<span class="linenr">85: </span>  }
<span class="linenr">86: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-org491a353" class="outline-2">
<h2 id="org491a353"><code>PrimesToFile2.java</code></h2>
<div class="outline-text-2" id="text-org491a353">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">ceil</span>;
<span class="linenr"> 2: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">sqrt</span>;
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">File</span>;
<span class="linenr"> 5: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span>;
<span class="linenr"> 6: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>;
<span class="linenr"> 7: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">IOException</span>;
<span class="linenr"> 8: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>;
<span class="linenr"> 9: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">CharBuffer</span>;
<span class="linenr">10: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">DoubleBuffer</span>;
<span class="linenr">11: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">LongBuffer</span>;
<span class="linenr">12: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #d55e00; font-weight: bold;">channels</span>.<span style="color: #0072b2; font-weight: bold;">FileChannel</span>;
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">class</span> <span style="color: #0072b2; font-weight: bold;">PrimesToFile2</span> {
<span class="linenr">15: </span>  <span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #0072b2; font-weight: bold;">void</span> <span style="color: #d55e00;">main</span>(<span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">args</span>) {
<span class="linenr">16: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">primesRequired</span> = 100; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Default count</span>
<span class="linenr">17: </span>    <span style="color: #56b4e9; font-weight: bold;">if</span> (args.length &gt; 0) {
<span class="linenr">18: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">19: </span>        primesRequired = Integer.valueOf(args[0]).intValue();
<span class="linenr">20: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">NumberFormatException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">21: </span>        System.out.println(<span style="color: #848ea9;">"Prime count value invalid. Using default of "</span> + primesRequired);
<span class="linenr">22: </span>      }
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>
<span class="linenr">25: </span>    <span style="color: #0072b2; font-weight: bold;">long</span>[] <span style="color: #e69f00; font-weight: bold;">primes</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">long</span>[primesRequired]; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Array to store primes</span>
<span class="linenr">26: </span>    primes[0] = 2; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Seed the first prime</span>
<span class="linenr">27: </span>    primes[1] = 3; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">and the second</span>
<span class="linenr">28: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">count</span> = 2; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Count of primes found - up to now, which is also the array index</span>
<span class="linenr">29: </span>    <span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">number</span> = 5; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Next integer to be tested</span>
<span class="linenr">30: </span>
<span class="linenr">31: </span>    <span style="color: #d55e00; font-weight: bold;">outer</span>:
<span class="linenr">32: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (; count &lt; <span style="color: #0072b2; font-weight: bold;">primesRequired</span>; number += 2) {
<span class="linenr">33: </span>
<span class="linenr">34: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">The maximum divisor we need to try is square root of number</span>
<span class="linenr">35: </span>      <span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">limit</span> = (<span style="color: #0072b2; font-weight: bold;">long</span>) ceil(sqrt((<span style="color: #0072b2; font-weight: bold;">double</span>) number));
<span class="linenr">36: </span>
<span class="linenr">37: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Divide by all the primes we have up to limit</span>
<span class="linenr">38: </span>      <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">i</span> = 1; i &lt; <span style="color: #0072b2; font-weight: bold;">count</span> &amp;&amp; primes[i] &lt;= limit; i++)
<span class="linenr">39: </span>        <span style="color: #56b4e9; font-weight: bold;">if</span> (number % primes[i] == 0) <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Is it an exact divisor?</span>
<span class="linenr">40: </span>        <span style="color: #56b4e9; font-weight: bold;">continue</span> <span style="color: #d55e00; font-weight: bold;">outer</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">yes, try the next number</span>
<span class="linenr">41: </span>
<span class="linenr">42: </span>      primes[count++] = number; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">We got one!</span>
<span class="linenr">43: </span>    }
<span class="linenr">44: </span>
<span class="linenr">45: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">aFile</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(<span style="color: #848ea9;">"/tmp/primes1.txt"</span>);
<span class="linenr">46: </span>    <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span> <span style="color: #e69f00; font-weight: bold;">outputFile</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">47: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">48: </span>      outputFile = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>(aFile);
<span class="linenr">49: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">50: </span>      e.printStackTrace(System.err);
<span class="linenr">51: </span>      System.exit(1);
<span class="linenr">52: </span>    }
<span class="linenr">53: </span>    <span style="color: #0072b2; font-weight: bold;">FileChannel</span> <span style="color: #e69f00; font-weight: bold;">file</span> = outputFile.getChannel();
<span class="linenr">54: </span>    <span style="color: #56b4e9; font-weight: bold;">final</span> <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">BUFFERSIZE</span> = 100; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Buffer size in bytes</span>
<span class="linenr">55: </span>    <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span> <span style="color: #e69f00; font-weight: bold;">buf</span> = ByteBuffer.allocate(BUFFERSIZE);
<span class="linenr">56: </span>
<span class="linenr">57: </span>    <span style="color: #0072b2; font-weight: bold;">DoubleBuffer</span> <span style="color: #e69f00; font-weight: bold;">doubleBuf</span> = buf.asDoubleBuffer();
<span class="linenr">58: </span>    buf.position(8);
<span class="linenr">59: </span>    <span style="color: #0072b2; font-weight: bold;">CharBuffer</span> <span style="color: #e69f00; font-weight: bold;">charBuf</span> = buf.asCharBuffer();
<span class="linenr">60: </span>    <span style="color: #0072b2; font-weight: bold;">LongBuffer</span> <span style="color: #e69f00; font-weight: bold;">longBuf</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">61: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">primeStr</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">62: </span>
<span class="linenr">63: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">prime</span> : primes) {
<span class="linenr">64: </span>      primeStr = <span style="color: #848ea9;">"prime = "</span> + prime; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create the string</span>
<span class="linenr">65: </span>      doubleBuf.put(0, (<span style="color: #0072b2; font-weight: bold;">double</span>) primeStr.length()); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Store the string length</span>
<span class="linenr">66: </span>      charBuf.put(primeStr); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Store the string</span>
<span class="linenr">67: </span>      buf.position(2 * charBuf.position() + 8); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Position for 3rd buffer</span>
<span class="linenr">68: </span>      longBuf = buf.asLongBuffer(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create the buffer</span>
<span class="linenr">69: </span>      longBuf.put(prime); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Store the binary long value</span>
<span class="linenr">70: </span>      buf.position(buf.position() + 8); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Set position after last value</span>
<span class="linenr">71: </span>      buf.flip(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">and flip</span>
<span class="linenr">72: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">73: </span>        file.write(buf); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Write the buffer as before.</span>
<span class="linenr">74: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">75: </span>        e.printStackTrace(System.err);
<span class="linenr">76: </span>        System.exit(1);
<span class="linenr">77: </span>      }
<span class="linenr">78: </span>      buf.clear();
<span class="linenr">79: </span>      doubleBuf.clear();
<span class="linenr">80: </span>      charBuf.clear();
<span class="linenr">81: </span>    }
<span class="linenr">82: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">83: </span>      System.out.println(<span style="color: #848ea9;">"File written is "</span> + file.size() + <span style="color: #848ea9;">" bytes."</span>);
<span class="linenr">84: </span>      outputFile.close(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Close the file and its channel</span>
<span class="linenr">85: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">86: </span>      e.printStackTrace(System.err);
<span class="linenr">87: </span>      System.exit(1);
<span class="linenr">88: </span>    }
<span class="linenr">89: </span>    System.exit(0);
<span class="linenr">90: </span>  }
<span class="linenr">91: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a7e2b1" class="outline-2">
<h2 id="org4a7e2b1"><code>PrimesToFile3.java</code></h2>
<div class="outline-text-2" id="text-org4a7e2b1">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">ceil</span>;
<span class="linenr"> 2: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">sqrt</span>;
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">File</span>;
<span class="linenr"> 5: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span>;
<span class="linenr"> 6: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>;
<span class="linenr"> 7: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">IOException</span>;
<span class="linenr"> 8: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>;
<span class="linenr"> 9: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #d55e00; font-weight: bold;">channels</span>.<span style="color: #0072b2; font-weight: bold;">FileChannel</span>;
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">class</span> <span style="color: #0072b2; font-weight: bold;">PrimesToFile3</span> {
<span class="linenr">12: </span>  <span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #0072b2; font-weight: bold;">void</span> <span style="color: #d55e00;">main</span>(<span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">args</span>) {
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">primesRequired</span> = 100; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Default count</span>
<span class="linenr">15: </span>    <span style="color: #56b4e9; font-weight: bold;">if</span> (args.length &gt; 0) {
<span class="linenr">16: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">17: </span>        primesRequired = Integer.valueOf(args[0]).intValue();
<span class="linenr">18: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">NumberFormatException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">19: </span>        System.out.println(<span style="color: #848ea9;">"Prime count value invalid. Using default of "</span> + primesRequired);
<span class="linenr">20: </span>      }
<span class="linenr">21: </span>    }
<span class="linenr">22: </span>
<span class="linenr">23: </span>    <span style="color: #0072b2; font-weight: bold;">long</span>[] <span style="color: #e69f00; font-weight: bold;">primes</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">long</span>[primesRequired]; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Array to store primes</span>
<span class="linenr">24: </span>    primes[0] = 2; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Seed the first prime</span>
<span class="linenr">25: </span>    primes[1] = 3; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">and the second</span>
<span class="linenr">26: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Count of primes found - up to now, which is also the array index</span>
<span class="linenr">27: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">count</span> = 2;
<span class="linenr">28: </span>    <span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">number</span> = 5; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Next integer to be tested</span>
<span class="linenr">29: </span>
<span class="linenr">30: </span>    <span style="color: #d55e00; font-weight: bold;">outer</span>:
<span class="linenr">31: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (; count &lt; <span style="color: #0072b2; font-weight: bold;">primesRequired</span>; number += 2) {
<span class="linenr">32: </span>
<span class="linenr">33: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">The maximum divisor we need to try is square root of number</span>
<span class="linenr">34: </span>      <span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">limit</span> = (<span style="color: #0072b2; font-weight: bold;">long</span>) ceil(sqrt((<span style="color: #0072b2; font-weight: bold;">double</span>) number));
<span class="linenr">35: </span>
<span class="linenr">36: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Divide by all the primes we have up to limit</span>
<span class="linenr">37: </span>      <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">i</span> = 1; i &lt; <span style="color: #0072b2; font-weight: bold;">count</span> &amp;&amp; primes[i] &lt;= limit; i++)
<span class="linenr">38: </span>        <span style="color: #56b4e9; font-weight: bold;">if</span> (number % primes[i] == 0) <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Is it an exact divisor?</span>
<span class="linenr">39: </span>        <span style="color: #56b4e9; font-weight: bold;">continue</span> <span style="color: #d55e00; font-weight: bold;">outer</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">yes, try the next number</span>
<span class="linenr">40: </span>
<span class="linenr">41: </span>      primes[count++] = number; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">We got one!</span>
<span class="linenr">42: </span>    }
<span class="linenr">43: </span>
<span class="linenr">44: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">aFile</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(<span style="color: #848ea9;">"C:/Beg Java Stuff/primes.txt"</span>);
<span class="linenr">45: </span>    <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span> <span style="color: #e69f00; font-weight: bold;">outputFile</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">46: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">47: </span>      outputFile = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>(aFile);
<span class="linenr">48: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">49: </span>      e.printStackTrace(System.err);
<span class="linenr">50: </span>      System.exit(1);
<span class="linenr">51: </span>    }
<span class="linenr">52: </span>    <span style="color: #0072b2; font-weight: bold;">FileChannel</span> <span style="color: #e69f00; font-weight: bold;">file</span> = outputFile.getChannel();
<span class="linenr">53: </span>
<span class="linenr">54: </span>    <span style="color: #56b4e9; font-weight: bold;">final</span> <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">BUFFERSIZE</span> = 1024; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Buffer size in bytes - bigger!</span>
<span class="linenr">55: </span>    <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span> <span style="color: #e69f00; font-weight: bold;">buf</span> = ByteBuffer.allocate(BUFFERSIZE);
<span class="linenr">56: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">primeStr</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">57: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">primesWritten</span> = 0;
<span class="linenr">58: </span>    <span style="color: #56b4e9; font-weight: bold;">while</span> (primesWritten &lt; primes.<span style="color: #0072b2; font-weight: bold;">length</span>) {
<span class="linenr">59: </span>      <span style="color: #56b4e9; font-weight: bold;">while</span> (primesWritten &lt; primes.<span style="color: #0072b2; font-weight: bold;">length</span>) {
<span class="linenr">60: </span>        primeStr = <span style="color: #848ea9;">"prime = "</span> + primes[primesWritten];
<span class="linenr">61: </span>        <span style="color: #56b4e9; font-weight: bold;">if</span> ((buf.position() + 2 * primeStr.length() + 16) &gt; buf.limit()) {
<span class="linenr">62: </span>          <span style="color: #56b4e9; font-weight: bold;">break</span>;
<span class="linenr">63: </span>        }
<span class="linenr">64: </span>        buf.asDoubleBuffer().put(0, (<span style="color: #0072b2; font-weight: bold;">double</span>) primeStr.length());
<span class="linenr">65: </span>        buf.position(buf.position() + 8);
<span class="linenr">66: </span>        buf.position(buf.position() + 2 * buf.asCharBuffer().put(primeStr).position());
<span class="linenr">67: </span>        buf.asLongBuffer().put(primes[primesWritten++]);
<span class="linenr">68: </span>        buf.position(buf.position() + 8);
<span class="linenr">69: </span>      }
<span class="linenr">70: </span>      buf.flip();
<span class="linenr">71: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">72: </span>        file.write(buf);
<span class="linenr">73: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">74: </span>        e.printStackTrace(System.err);
<span class="linenr">75: </span>        System.exit(1);
<span class="linenr">76: </span>      }
<span class="linenr">77: </span>      buf.clear();
<span class="linenr">78: </span>    }
<span class="linenr">79: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">80: </span>      System.out.println(<span style="color: #848ea9;">"File written is "</span> + file.size() + <span style="color: #848ea9;">" bytes."</span>);
<span class="linenr">81: </span>      outputFile.close(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Close the file and its channel</span>
<span class="linenr">82: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">83: </span>      e.printStackTrace(System.err);
<span class="linenr">84: </span>      System.exit(1);
<span class="linenr">85: </span>    }
<span class="linenr">86: </span>    System.exit(0);
<span class="linenr">87: </span>  }
<span class="linenr">88: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd5b46e0" class="outline-2">
<h2 id="orgd5b46e0"><code>PrimesToFile.java</code></h2>
<div class="outline-text-2" id="text-orgd5b46e0">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">ceil</span>;
<span class="linenr"> 2: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">min</span>;
<span class="linenr"> 3: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">lang</span>.Math.<span style="color: #0072b2; font-weight: bold;">sqrt</span>;
<span class="linenr"> 4: </span>
<span class="linenr"> 5: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">File</span>;
<span class="linenr"> 6: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span>;
<span class="linenr"> 7: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>;
<span class="linenr"> 8: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">IOException</span>;
<span class="linenr"> 9: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>;
<span class="linenr">10: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">LongBuffer</span>;
<span class="linenr">11: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #d55e00; font-weight: bold;">channels</span>.<span style="color: #0072b2; font-weight: bold;">FileChannel</span>;
<span class="linenr">12: </span>
<span class="linenr">13: </span><span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">class</span> <span style="color: #0072b2; font-weight: bold;">PrimesToFile</span> {
<span class="linenr">14: </span>  <span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #0072b2; font-weight: bold;">void</span> <span style="color: #d55e00;">main</span>(<span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">args</span>) {
<span class="linenr">15: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">primesRequired</span> = 100; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Default count</span>
<span class="linenr">16: </span>    <span style="color: #56b4e9; font-weight: bold;">if</span> (args.length &gt; 0) {
<span class="linenr">17: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">18: </span>        primesRequired = Integer.valueOf(args[0]).intValue();
<span class="linenr">19: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">NumberFormatException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">20: </span>        System.out.println(<span style="color: #848ea9;">"Prime count value invalid. Using default of "</span> + primesRequired);
<span class="linenr">21: </span>      }
<span class="linenr">22: </span>    }
<span class="linenr">23: </span>
<span class="linenr">24: </span>    <span style="color: #0072b2; font-weight: bold;">long</span>[] <span style="color: #e69f00; font-weight: bold;">primes</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">long</span>[primesRequired]; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Array to store primes</span>
<span class="linenr">25: </span>    primes[0] = 2; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Seed the first prime</span>
<span class="linenr">26: </span>    primes[1] = 3; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">and the second</span>
<span class="linenr">27: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Count of primes found - up to now, which is also the array index</span>
<span class="linenr">28: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">count</span> = 2;
<span class="linenr">29: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Next integer to be tested</span>
<span class="linenr">30: </span>    <span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">number</span> = 5;
<span class="linenr">31: </span>
<span class="linenr">32: </span>    <span style="color: #d55e00; font-weight: bold;">outer</span>:
<span class="linenr">33: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (; count &lt; <span style="color: #0072b2; font-weight: bold;">primesRequired</span>; number += 2) {
<span class="linenr">34: </span>
<span class="linenr">35: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">The maximum divisor we need to try is square root of number</span>
<span class="linenr">36: </span>      <span style="color: #0072b2; font-weight: bold;">long</span> <span style="color: #e69f00; font-weight: bold;">limit</span> = (<span style="color: #0072b2; font-weight: bold;">long</span>) ceil(sqrt((<span style="color: #0072b2; font-weight: bold;">double</span>) number));
<span class="linenr">37: </span>
<span class="linenr">38: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Divide by all the primes we have up to limit</span>
<span class="linenr">39: </span>      <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">i</span> = 1; i &lt; <span style="color: #0072b2; font-weight: bold;">count</span> &amp;&amp; primes[i] &lt;= limit; i++)
<span class="linenr">40: </span>        <span style="color: #56b4e9; font-weight: bold;">if</span> (number % primes[i] == 0) <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Is it an exact divisor?</span>
<span class="linenr">41: </span>        <span style="color: #56b4e9; font-weight: bold;">continue</span> <span style="color: #d55e00; font-weight: bold;">outer</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">yes, try the next number</span>
<span class="linenr">42: </span>
<span class="linenr">43: </span>      primes[count++] = number; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">We got one!</span>
<span class="linenr">44: </span>    }
<span class="linenr">45: </span>
<span class="linenr">46: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">aFile</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(<span style="color: #848ea9;">"C:/Beg Java Stuff/primes.bin"</span>);
<span class="linenr">47: </span>    <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span> <span style="color: #e69f00; font-weight: bold;">outputFile</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">48: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">49: </span>      outputFile = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>(aFile); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create the file stream</span>
<span class="linenr">50: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">51: </span>      e.printStackTrace(System.err);
<span class="linenr">52: </span>      System.exit(1);
<span class="linenr">53: </span>    }
<span class="linenr">54: </span>    <span style="color: #0072b2; font-weight: bold;">FileChannel</span> <span style="color: #e69f00; font-weight: bold;">file</span> = outputFile.getChannel(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Get the channel from the stream</span>
<span class="linenr">55: </span>    <span style="color: #56b4e9; font-weight: bold;">final</span> <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">BUFFERSIZE</span> = 100; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Byte buffer size</span>
<span class="linenr">56: </span>    <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span> <span style="color: #e69f00; font-weight: bold;">buf</span> = ByteBuffer.allocate(BUFFERSIZE);
<span class="linenr">57: </span>    <span style="color: #0072b2; font-weight: bold;">LongBuffer</span> <span style="color: #e69f00; font-weight: bold;">longBuf</span> = buf.asLongBuffer(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">View buffer for type long</span>
<span class="linenr">58: </span>
<span class="linenr">59: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Count of primes written to file</span>
<span class="linenr">60: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">primesWritten</span> = 0;
<span class="linenr">61: </span>
<span class="linenr">62: </span>    <span style="color: #56b4e9; font-weight: bold;">while</span> (primesWritten &lt; primes.<span style="color: #0072b2; font-weight: bold;">length</span>) {
<span class="linenr">63: </span>      longBuf.put(
<span class="linenr">64: </span>          primes, <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Array to be written</span>
<span class="linenr">65: </span>          primesWritten, <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Index of 1st element to write</span>
<span class="linenr">66: </span>          min(longBuf.capacity(), primes.length - primesWritten));
<span class="linenr">67: </span>      buf.limit(8 * longBuf.position()); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Update byte buffer position</span>
<span class="linenr">68: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">69: </span>        file.write(buf);
<span class="linenr">70: </span>        primesWritten += longBuf.position();
<span class="linenr">71: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">72: </span>        e.printStackTrace(System.err);
<span class="linenr">73: </span>        System.exit(1);
<span class="linenr">74: </span>      }
<span class="linenr">75: </span>      longBuf.clear();
<span class="linenr">76: </span>      buf.clear();
<span class="linenr">77: </span>    }
<span class="linenr">78: </span>
<span class="linenr">79: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">80: </span>      System.out.println(<span style="color: #848ea9;">"File written is "</span> + file.size() + <span style="color: #848ea9;">" bytes."</span>);
<span class="linenr">81: </span>      outputFile.close(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Close the file and its channel</span>
<span class="linenr">82: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">83: </span>      e.printStackTrace(System.err);
<span class="linenr">84: </span>      System.exit(1);
<span class="linenr">85: </span>    }
<span class="linenr">86: </span>    System.exit(0);
<span class="linenr">87: </span>  }
<span class="linenr">88: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe29d8f" class="outline-2">
<h2 id="orgbe29d8f"><code>UsingAFormatter.java</code></h2>
<div class="outline-text-2" id="text-orgbe29d8f">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">File</span>;
<span class="linenr"> 2: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span>;
<span class="linenr"> 3: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>;
<span class="linenr"> 4: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">IOException</span>;
<span class="linenr"> 5: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>;
<span class="linenr"> 6: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">CharBuffer</span>;
<span class="linenr"> 7: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #d55e00; font-weight: bold;">channels</span>.<span style="color: #0072b2; font-weight: bold;">FileChannel</span>;
<span class="linenr"> 8: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">util</span>.<span style="color: #0072b2; font-weight: bold;">Formatter</span>;
<span class="linenr"> 9: </span>
<span class="linenr">10: </span><span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">class</span> <span style="color: #0072b2; font-weight: bold;">UsingAFormatter</span> {
<span class="linenr">11: </span>  <span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #0072b2; font-weight: bold;">void</span> <span style="color: #d55e00;">main</span>(<span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">args</span>) {
<span class="linenr">12: </span>    <span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">phrases</span> = {
<span class="linenr">13: </span>      <span style="color: #848ea9;">"Rome wasn't burned in a day."</span>,
<span class="linenr">14: </span>      <span style="color: #848ea9;">"It's a bold mouse that sits in the cat's ear."</span>,
<span class="linenr">15: </span>      <span style="color: #848ea9;">"An ounce of practice is worth a pound of instruction."</span>
<span class="linenr">16: </span>    };
<span class="linenr">17: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">dirname</span> = <span style="color: #848ea9;">"/tmp"</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Directory name</span>
<span class="linenr">18: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">filename</span> = <span style="color: #848ea9;">"Phrases.txt"</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">File name</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">dir</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(dirname); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">File object for directory</span>
<span class="linenr">21: </span>
<span class="linenr">22: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Now check out the directory</span>
<span class="linenr">23: </span>    <span style="color: #56b4e9; font-weight: bold;">if</span> (!dir.exists()) { <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">If directory does not exist</span>
<span class="linenr">24: </span>      <span style="color: #56b4e9; font-weight: bold;">if</span> (!dir.mkdir()) { <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">...create it</span>
<span class="linenr">25: </span>        System.out.println(<span style="color: #848ea9;">"Cannot create directory: "</span> + dirname);
<span class="linenr">26: </span>        System.exit(1);
<span class="linenr">27: </span>      }
<span class="linenr">28: </span>    } <span style="color: #56b4e9; font-weight: bold;">else</span> <span style="color: #56b4e9; font-weight: bold;">if</span> (!dir.isDirectory()) {
<span class="linenr">29: </span>      System.err.println(dirname + <span style="color: #848ea9;">" is not a directory"</span>);
<span class="linenr">30: </span>      System.exit(1);
<span class="linenr">31: </span>    }
<span class="linenr">32: </span>
<span class="linenr">33: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create the filestream</span>
<span class="linenr">34: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">aFile</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(dir, filename); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">File object for the file path</span>
<span class="linenr">35: </span>    <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span> <span style="color: #e69f00; font-weight: bold;">outputFile</span> = <span style="color: #d55e00; font-weight: bold;">null</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Place to store the stream reference</span>
<span class="linenr">36: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">37: </span>      outputFile = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>(aFile, <span style="color: #d55e00; font-weight: bold;">true</span>);
<span class="linenr">38: </span>      System.out.println(<span style="color: #848ea9;">"File stream created successfully."</span>);
<span class="linenr">39: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">40: </span>      e.printStackTrace(System.err);
<span class="linenr">41: </span>    }
<span class="linenr">42: </span>
<span class="linenr">43: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create the file output stream channel</span>
<span class="linenr">44: </span>    <span style="color: #0072b2; font-weight: bold;">FileChannel</span> <span style="color: #e69f00; font-weight: bold;">outChannel</span> = outputFile.getChannel();
<span class="linenr">45: </span>
<span class="linenr">46: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create byte buffer to hold data to be written</span>
<span class="linenr">47: </span>    <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span> <span style="color: #e69f00; font-weight: bold;">buf</span> = ByteBuffer.allocate(1024);
<span class="linenr">48: </span>    System.out.println(<span style="color: #848ea9;">"\nByte buffer:"</span>);
<span class="linenr">49: </span>    System.out.printf(
<span class="linenr">50: </span>        <span style="color: #848ea9;">"position = %2d  Limit = %4d  capacity = %4d%n"</span>,
<span class="linenr">51: </span>        buf.position(), buf.limit(), buf.capacity());
<span class="linenr">52: </span>
<span class="linenr">53: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create a view buffer</span>
<span class="linenr">54: </span>    <span style="color: #0072b2; font-weight: bold;">CharBuffer</span> <span style="color: #e69f00; font-weight: bold;">charBuf</span> = buf.asCharBuffer();
<span class="linenr">55: </span>    System.out.println(<span style="color: #848ea9;">"Char view buffer:"</span>);
<span class="linenr">56: </span>    System.out.printf(
<span class="linenr">57: </span>        <span style="color: #848ea9;">"position = %2d  Limit = %4d  capacity = %4d%n"</span>,
<span class="linenr">58: </span>        charBuf.position(), charBuf.limit(), charBuf.capacity());
<span class="linenr">59: </span>    <span style="color: #0072b2; font-weight: bold;">Formatter</span> <span style="color: #e69f00; font-weight: bold;">formatter</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">Formatter</span>(charBuf);
<span class="linenr">60: </span>
<span class="linenr">61: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Write to the view buffer using a formatter</span>
<span class="linenr">62: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">number</span> = 0; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Proverb number</span>
<span class="linenr">63: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">phrase</span> : phrases) {
<span class="linenr">64: </span>      formatter.format(<span style="color: #848ea9;">"%nProverb%3d: %s"</span>, ++number, phrase);
<span class="linenr">65: </span>      System.out.println(<span style="color: #848ea9;">"\nView buffer after loading:"</span>);
<span class="linenr">66: </span>      System.out.printf(
<span class="linenr">67: </span>          <span style="color: #848ea9;">"position = %2d  Limit = %4d  capacity = %4d%n"</span>,
<span class="linenr">68: </span>          charBuf.position(), charBuf.limit(), charBuf.capacity());
<span class="linenr">69: </span>      charBuf.flip(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Flip the view buffer</span>
<span class="linenr">70: </span>      System.out.println(<span style="color: #848ea9;">"View buffer after flip:"</span>);
<span class="linenr">71: </span>      System.out.printf(
<span class="linenr">72: </span>          <span style="color: #848ea9;">"position = %2d  Limit = %4d  length = %4d%n"</span>,
<span class="linenr">73: </span>          charBuf.position(), charBuf.limit(), charBuf.length());
<span class="linenr">74: </span>      buf.limit(2 * charBuf.length()); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Set byte buffer limit</span>
<span class="linenr">75: </span>
<span class="linenr">76: </span>      System.out.println(<span style="color: #848ea9;">"Byte buffer after limit update:"</span>);
<span class="linenr">77: </span>      System.out.printf(
<span class="linenr">78: </span>          <span style="color: #848ea9;">"position = %2d  Limit = %4d  length = %4d%n"</span>,
<span class="linenr">79: </span>          buf.position(), buf.limit(), buf.remaining());
<span class="linenr">80: </span>
<span class="linenr">81: </span>      <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Write the file</span>
<span class="linenr">82: </span>      <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">83: </span>        outChannel.write(buf); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Write the buffer to the file channel</span>
<span class="linenr">84: </span>        System.out.println(<span style="color: #848ea9;">"Buffer contents written to file."</span>);
<span class="linenr">85: </span>        buf.clear();
<span class="linenr">86: </span>        charBuf.clear();
<span class="linenr">87: </span>      } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">88: </span>        e.printStackTrace(System.err);
<span class="linenr">89: </span>        System.exit(1);
<span class="linenr">90: </span>      }
<span class="linenr">91: </span>    }
<span class="linenr">92: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">93: </span>      outputFile.close(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Close the O/P stream &amp; the channel</span>
<span class="linenr">94: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">95: </span>      e.printStackTrace(System.err);
<span class="linenr">96: </span>    }
<span class="linenr">97: </span>  }
<span class="linenr">98: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-org0f662c6" class="outline-2">
<h2 id="org0f662c6"><code>WriteAStringAsBytes.java</code></h2>
<div class="outline-text-2" id="text-org0f662c6">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">File</span>;
<span class="linenr"> 2: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span>;
<span class="linenr"> 3: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>;
<span class="linenr"> 4: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">IOException</span>;
<span class="linenr"> 5: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>;
<span class="linenr"> 6: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #d55e00; font-weight: bold;">channels</span>.<span style="color: #0072b2; font-weight: bold;">FileChannel</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">class</span> <span style="color: #0072b2; font-weight: bold;">WriteAStringAsBytes</span> {
<span class="linenr"> 9: </span>  <span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #0072b2; font-weight: bold;">void</span> <span style="color: #d55e00;">main</span>(<span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">args</span>) {
<span class="linenr">10: </span>
<span class="linenr">11: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">phrase</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">String</span>(<span style="color: #848ea9;">"Garbage in, garbage out\n"</span>);
<span class="linenr">12: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">dirname</span> = <span style="color: #848ea9;">"C:/Beg Java Stuff"</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Directory name</span>
<span class="linenr">13: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">filename</span> = <span style="color: #848ea9;">"byteData.txt"</span>;
<span class="linenr">14: </span>
<span class="linenr">15: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">aFile</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(dirname, filename);
<span class="linenr">16: </span>
<span class="linenr">17: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create the file output stream</span>
<span class="linenr">18: </span>    <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span> <span style="color: #e69f00; font-weight: bold;">file</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">19: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">20: </span>      file = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>(aFile, <span style="color: #d55e00; font-weight: bold;">true</span>);
<span class="linenr">21: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">22: </span>      e.printStackTrace(System.err);
<span class="linenr">23: </span>    }
<span class="linenr">24: </span>    <span style="color: #0072b2; font-weight: bold;">FileChannel</span> <span style="color: #e69f00; font-weight: bold;">outChannel</span> = file.getChannel();
<span class="linenr">25: </span>    <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span> <span style="color: #e69f00; font-weight: bold;">buf</span> = ByteBuffer.allocate(phrase.length());
<span class="linenr">26: </span>    <span style="color: #0072b2; font-weight: bold;">byte</span>[] <span style="color: #e69f00; font-weight: bold;">bytes</span> = phrase.getBytes();
<span class="linenr">27: </span>    buf.put(bytes);
<span class="linenr">28: </span>    buf.flip();
<span class="linenr">29: </span>
<span class="linenr">30: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">31: </span>      outChannel.write(buf);
<span class="linenr">32: </span>      file.close(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Close the output stream &amp; the channel</span>
<span class="linenr">33: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">34: </span>      e.printStackTrace(System.err);
<span class="linenr">35: </span>    }
<span class="linenr">36: </span>  }
<span class="linenr">37: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1a9ebf" class="outline-2">
<h2 id="orge1a9ebf"><code>WriteAString.java</code></h2>
<div class="outline-text-2" id="text-orge1a9ebf">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">File</span>;
<span class="linenr"> 2: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span>;
<span class="linenr"> 3: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>;
<span class="linenr"> 4: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">IOException</span>;
<span class="linenr"> 5: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>;
<span class="linenr"> 6: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #d55e00; font-weight: bold;">channels</span>.<span style="color: #0072b2; font-weight: bold;">FileChannel</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">class</span> <span style="color: #0072b2; font-weight: bold;">WriteAString</span> {
<span class="linenr"> 9: </span>  <span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #0072b2; font-weight: bold;">void</span> <span style="color: #d55e00;">main</span>(<span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">args</span>) {
<span class="linenr">10: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">phrase</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">String</span>(<span style="color: #848ea9;">"Garbage in, garbage out\n"</span>);
<span class="linenr">11: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">dirname</span> = <span style="color: #848ea9;">"C:/Beg Java Stuff"</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Directory name</span>
<span class="linenr">12: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">filename</span> = <span style="color: #848ea9;">"charData.txt"</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">File name</span>
<span class="linenr">13: </span>
<span class="linenr">14: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">dir</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(dirname); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">File object for directory</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Now check out the directory</span>
<span class="linenr">17: </span>    <span style="color: #56b4e9; font-weight: bold;">if</span> (!dir.exists()) { <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">If directory does not exist</span>
<span class="linenr">18: </span>      <span style="color: #56b4e9; font-weight: bold;">if</span> (!dir.mkdir()) { <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">...create it</span>
<span class="linenr">19: </span>        System.out.println(<span style="color: #848ea9;">"Cannot create directory: "</span> + dirname);
<span class="linenr">20: </span>        System.exit(1);
<span class="linenr">21: </span>      }
<span class="linenr">22: </span>    } <span style="color: #56b4e9; font-weight: bold;">else</span> <span style="color: #56b4e9; font-weight: bold;">if</span> (!dir.isDirectory()) {
<span class="linenr">23: </span>      System.err.println(dirname + <span style="color: #848ea9;">" is not a directory"</span>);
<span class="linenr">24: </span>      System.exit(1);
<span class="linenr">25: </span>    }
<span class="linenr">26: </span>
<span class="linenr">27: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create the filestream</span>
<span class="linenr">28: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">aFile</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(dir, filename); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">File object for the file path</span>
<span class="linenr">29: </span>    <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span> <span style="color: #e69f00; font-weight: bold;">outputFile</span> = <span style="color: #d55e00; font-weight: bold;">null</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Place to store the stream reference</span>
<span class="linenr">30: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">31: </span>      outputFile = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>(aFile, <span style="color: #d55e00; font-weight: bold;">true</span>);
<span class="linenr">32: </span>      System.out.println(<span style="color: #848ea9;">"File stream created successfully."</span>);
<span class="linenr">33: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">34: </span>      e.printStackTrace(System.err);
<span class="linenr">35: </span>    }
<span class="linenr">36: </span>
<span class="linenr">37: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create the file output stream channel</span>
<span class="linenr">38: </span>    <span style="color: #0072b2; font-weight: bold;">FileChannel</span> <span style="color: #e69f00; font-weight: bold;">outChannel</span> = outputFile.getChannel();
<span class="linenr">39: </span>
<span class="linenr">40: </span>    <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span> <span style="color: #e69f00; font-weight: bold;">buf</span> = ByteBuffer.allocate(1024);
<span class="linenr">41: </span>    System.out.println(
<span class="linenr">42: </span>        <span style="color: #848ea9;">"New buffer:           position = "</span>
<span class="linenr">43: </span>            + buf.position()
<span class="linenr">44: </span>            + <span style="color: #848ea9;">"\tLimit = "</span>
<span class="linenr">45: </span>            + buf.limit()
<span class="linenr">46: </span>            + <span style="color: #848ea9;">"\tcapacity = "</span>
<span class="linenr">47: </span>            + buf.capacity());
<span class="linenr">48: </span>
<span class="linenr">49: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Load the data into the buffer</span>
<span class="linenr">50: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">char</span> <span style="color: #d55e00;">ch</span> : phrase.toCharArray()) {
<span class="linenr">51: </span>      buf.putChar(ch);
<span class="linenr">52: </span>    }
<span class="linenr">53: </span>
<span class="linenr">54: </span>    System.out.println(
<span class="linenr">55: </span>        <span style="color: #848ea9;">"Buffer after loading: position = "</span>
<span class="linenr">56: </span>            + buf.position()
<span class="linenr">57: </span>            + <span style="color: #848ea9;">"\tLimit = "</span>
<span class="linenr">58: </span>            + buf.limit()
<span class="linenr">59: </span>            + <span style="color: #848ea9;">"\tcapacity = "</span>
<span class="linenr">60: </span>            + buf.capacity());
<span class="linenr">61: </span>    buf.flip(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Flip the buffer ready for file write</span>
<span class="linenr">62: </span>    System.out.println(
<span class="linenr">63: </span>        <span style="color: #848ea9;">"Buffer after flip:    position = "</span>
<span class="linenr">64: </span>            + buf.position()
<span class="linenr">65: </span>            + <span style="color: #848ea9;">"\tLimit = "</span>
<span class="linenr">66: </span>            + buf.limit()
<span class="linenr">67: </span>            + <span style="color: #848ea9;">"\tcapacity = "</span>
<span class="linenr">68: </span>            + buf.capacity());
<span class="linenr">69: </span>
<span class="linenr">70: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Write the file</span>
<span class="linenr">71: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">72: </span>      outChannel.write(buf); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Write the buffer to the file channel</span>
<span class="linenr">73: </span>      outputFile.close(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Close the O/P stream &amp; the channel</span>
<span class="linenr">74: </span>      System.out.println(<span style="color: #848ea9;">"Buffer contents written to file."</span>);
<span class="linenr">75: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">76: </span>      e.printStackTrace(System.err);
<span class="linenr">77: </span>    }
<span class="linenr">78: </span>    System.exit(0);
<span class="linenr">79: </span>  }
<span class="linenr">80: </span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-org92e4133" class="outline-2">
<h2 id="org92e4133"><code>WriteProverbs.java</code></h2>
<div class="outline-text-2" id="text-org92e4133">
<div class="org-src-container">
<pre class="src src-java"><span class="linenr"> 1: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">File</span>;
<span class="linenr"> 2: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span>;
<span class="linenr"> 3: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>;
<span class="linenr"> 4: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">io</span>.<span style="color: #0072b2; font-weight: bold;">IOException</span>;
<span class="linenr"> 5: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #0072b2; font-weight: bold;">ByteBuffer</span>;
<span class="linenr"> 6: </span><span style="color: #56b4e9; font-weight: bold;">import</span> <span style="color: #d55e00; font-weight: bold;">java</span>.<span style="color: #d55e00; font-weight: bold;">nio</span>.<span style="color: #d55e00; font-weight: bold;">channels</span>.<span style="color: #0072b2; font-weight: bold;">FileChannel</span>;
<span class="linenr"> 7: </span>
<span class="linenr"> 8: </span><span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">class</span> <span style="color: #0072b2; font-weight: bold;">WriteProverbs</span> {
<span class="linenr"> 9: </span>  <span style="color: #56b4e9; font-weight: bold;">public</span> <span style="color: #56b4e9; font-weight: bold;">static</span> <span style="color: #0072b2; font-weight: bold;">void</span> <span style="color: #d55e00;">main</span>(<span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">args</span>) {
<span class="linenr">10: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">dirName</span> = <span style="color: #848ea9;">"/tmp"</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Directory for the output file</span>
<span class="linenr">11: </span>    <span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">fileName</span> = <span style="color: #848ea9;">"Proverbs.txt"</span>; <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Name of the output file</span>
<span class="linenr">12: </span>    <span style="color: #0072b2; font-weight: bold;">String</span>[] <span style="color: #e69f00; font-weight: bold;">sayings</span> = {
<span class="linenr">13: </span>      <span style="color: #848ea9;">"Indecision maximizes flexibility."</span>,
<span class="linenr">14: </span>      <span style="color: #848ea9;">"Only the mediocre are always at their best."</span>,
<span class="linenr">15: </span>      <span style="color: #848ea9;">"A little knowledge is a dangerous thing."</span>,
<span class="linenr">16: </span>      <span style="color: #848ea9;">"Many a mickle makes a muckle."</span>,
<span class="linenr">17: </span>      <span style="color: #848ea9;">"Who begins too much achieves little."</span>,
<span class="linenr">18: </span>      <span style="color: #848ea9;">"Who knows most says least."</span>,
<span class="linenr">19: </span>      <span style="color: #848ea9;">"A wise man sits on the hole in his carpet."</span>
<span class="linenr">20: </span>    };
<span class="linenr">21: </span>    <span style="color: #0072b2; font-weight: bold;">File</span> <span style="color: #e69f00; font-weight: bold;">aFile</span> = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">File</span>(dirName, fileName);
<span class="linenr">22: </span>
<span class="linenr">23: </span>    <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span> <span style="color: #e69f00; font-weight: bold;">outputFile</span> = <span style="color: #d55e00; font-weight: bold;">null</span>;
<span class="linenr">24: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">25: </span>      outputFile = <span style="color: #56b4e9; font-weight: bold;">new</span> <span style="color: #0072b2; font-weight: bold;">FileOutputStream</span>(aFile, <span style="color: #d55e00; font-weight: bold;">true</span>);
<span class="linenr">26: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">FileNotFoundException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">27: </span>      e.printStackTrace(System.err);
<span class="linenr">28: </span>      System.exit(1);
<span class="linenr">29: </span>    }
<span class="linenr">30: </span>    <span style="color: #0072b2; font-weight: bold;">FileChannel</span> <span style="color: #e69f00; font-weight: bold;">outChannel</span> = outputFile.getChannel();
<span class="linenr">31: </span>
<span class="linenr">32: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Create a buffer to accommodate the longest string + its length value</span>
<span class="linenr">33: </span>    <span style="color: #0072b2; font-weight: bold;">int</span> <span style="color: #e69f00; font-weight: bold;">maxLength</span> = 0;
<span class="linenr">34: </span>    <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">saying</span> : sayings) {
<span class="linenr">35: </span>      <span style="color: #56b4e9; font-weight: bold;">if</span> (maxLength &lt; saying.<span style="color: #0072b2; font-weight: bold;">length</span>()) maxLength = saying.length();
<span class="linenr">36: </span>    }
<span class="linenr">37: </span>
<span class="linenr">38: </span>    <span style="color: #0072b2; font-weight: bold;">ByteBuffer</span> <span style="color: #e69f00; font-weight: bold;">buf</span> = ByteBuffer.allocate(2 * maxLength + 4);
<span class="linenr">39: </span>
<span class="linenr">40: </span>    <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Write the file</span>
<span class="linenr">41: </span>    <span style="color: #56b4e9; font-weight: bold;">try</span> {
<span class="linenr">42: </span>      <span style="color: #56b4e9; font-weight: bold;">for</span> (<span style="color: #0072b2; font-weight: bold;">String</span> <span style="color: #e69f00; font-weight: bold;">saying</span> : sayings) {
<span class="linenr">43: </span>        buf.putInt(saying.length()).asCharBuffer().put(saying);
<span class="linenr">44: </span>        buf.position(buf.position() + 2 * saying.length()).flip();
<span class="linenr">45: </span>        outChannel.write(buf); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Write the buffer to the file channel</span>
<span class="linenr">46: </span>        buf.clear();
<span class="linenr">47: </span>      }
<span class="linenr">48: </span>      outputFile.close(); <span style="color: #009e73; font-style: italic;">// </span><span style="color: #009e73; font-style: italic;">Close the output stream &amp; the channel</span>
<span class="linenr">49: </span>      System.out.println(<span style="color: #848ea9;">"Proverbs written to file."</span>);
<span class="linenr">50: </span>    } <span style="color: #56b4e9; font-weight: bold;">catch</span> (<span style="color: #0072b2; font-weight: bold;">IOException</span> <span style="color: #e69f00; font-weight: bold;">e</span>) {
<span class="linenr">51: </span>      e.printStackTrace(System.err);
<span class="linenr">52: </span>      System.exit(1);
<span class="linenr">53: </span>    }
<span class="linenr">54: </span>    System.exit(0);
<span class="linenr">55: </span>  }
<span class="linenr">56: </span>}
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="validation"></p>
</div>
</body>
</html>
